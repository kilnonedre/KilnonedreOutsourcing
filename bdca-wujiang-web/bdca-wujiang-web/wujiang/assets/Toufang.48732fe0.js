import{C as E}from"./CommonHeader.a228caf3.js";import{m as T,f as k}from"./api.22883e35.js";import{_ as U,r as d,k as I,o as f,c as _,d as o,b as c,w as s,m as M,i as D,f as w,F as B,h as R,t as P}from"./index.22501be6.js";const H={firstColumnName:{label:"\u4E00\u7EA7\u680F\u76EE",width:"120"},secondColumnName:{label:"\u4E8C\u7EA7\u680F\u76EE",width:"150"},thirdColumnName:{label:"\u4E09\u7EA7\u680F\u76EE",width:"150"},programmeName:{label:"\u8282\u76EE\u540D\u79F0",width:"150"},putStartTime:{label:"\u6295\u653E\u5F00\u59CB\u65F6\u95F4",width:"150"},putEndTime:{label:"\u6295\u653E\u7ED3\u675F\u65F6\u95F4",width:"150"},pictureSize:{label:"\u5C3A\u5BF8",width:"100"},picturePath:{label:"\u56FE\u7247\u7F29\u7565",width:"120"},createTime:{label:"\u521B\u5EFA\u65F6\u95F4",width:"150"},updateTime:{label:"\u66F4\u65B0\u65F6\u95F4",width:"150"},createUserId:{label:"\u521B\u5EFA\u7684\u7528\u6237id",width:"180"}},q={components:{CommonHeader:E},data(){return{programmeName:"",lanmu:"",lanmuList:[],lanmu2:"",firstColumnName:"",secondColumnName:"",thirdColumnName:"",datetime:"",dialogVisible:!1,dialogTitle:"",baseUrl:window.config.baseUrl,srcList:[],fileForm:null,fileList:[],toufangForm:{id:"",xmtColumnManageId:"",programmeName:"",type:"",platform:"",picturePath:"",putStartTime:"",putEndTime:"",pictureSize:"",remark:""},toufangRules:{xmtColumnManageId:[{required:!0,message:"\u8BF7\u9009\u62E9\u680F\u76EE\u4F4D\u7F6E",trigger:"blur"}],programmeName:[{required:!0,message:"\u8BF7\u8F93\u5165\u8282\u76EE\u540D\u79F0",trigger:"blur"}],putStartTime:[{required:!0,message:"\u8BF7\u8F93\u5165\u6295\u653E\u5F00\u59CB\u65F6\u95F4",trigger:"blur"}],pictureSize:[{required:!0,message:"\u8BF7\u8F93\u5165\u56FE\u7247\u5C3A\u5BF8",trigger:"blur"}]},loading:!1,tableHeader:H,tableData:[],ascs:"",descs:"",pageSize:100,currentPage:1,total:1}},methods:{async initList(){await T.getColumnSelector().then(l=>{this.lanmuList=l})},getTableList(){this.loading=!0,this.tableData=[],this.srcList=[],T.getColumnPutPlan({programmeName:this.programmeName,firstColumnName:this.firstColumnName,secondColumnName:this.secondColumnName,thirdColumnName:this.thirdColumnName,putStartTime:this.datetime?this.datetime[0].getTime():"",putEndTime:this.datetime?this.datetime[1].getTime():"",size:this.pageSize,current:this.currentPage,descs:this.descs,ascs:this.ascs}).then(l=>{this.tableData=l.records,this.total=l.total,l.records.forEach(e=>{this.srcList.push(this.baseUrl+e.picturePath)})}).finally(()=>{this.loading=!1,this.$nextTick(()=>{this.$refs.toufang.doLayout()})})},search(){this.currentPage=1,this.getTableList()},changeTime(){this.getTableList()},changeLanmu(l){this.firstColumnName=l?l[0]:"",this.secondColumnName=l&&l.length>1?l[1]:"",this.thirdColumnName=l&&l.length>2?l[2]:"",this.getTableList()},changeLanmu2(l){for(let e of this.lanmuList)if(e.value==l[0]){for(let n of e.children)if(n.value==l[1]){for(let r of n.children)if(r.value==l[2]){this.toufangForm.xmtColumnManageId=parseInt(r.id),this.toufangForm.pictureSize=r.size;break}}}},addPutPlan(){this.dialogTitle="\u65B0\u589E\u8BA1\u5212",this.dialogVisible=!0},editPutPlan(l,e){this.dialogTitle="\u7F16\u8F91\u8BA1\u5212",this.dialogVisible=!0;let n=[];Object.keys(this.toufangForm).forEach(r=>{if(r==="xmtColumnManageId"){this.toufangForm[r]=e[r]||this.toufangForm[r];for(let t of this.lanmuList)if(t.label==e.firstColumnName){n.push(t.label);for(let a of t.children)if(a.label==e.secondColumnName){n.push(a.label);for(let h of a.children)if(h.label==e.thirdColumnName){n.push(h.label),this.lanmu2=n;break}}}}else if(r==="picturePath"){let t={url:this.baseUrl+e[r]};this.fileList.push(t),this.toufangForm[r]=e[r]||this.toufangForm[r]}else r==="putStartTime"||r==="putEndTime"?e[r]&&(this.toufangForm[r]=new Date(e[r])):this.toufangForm[r]=e[r]||this.toufangForm[r]})},delPutPlan(l,e){this.$confirm("\u60A8\u786E\u5B9A\u5220\u9664?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{T.delColumnPutPlan(e.id).then(()=>{this.$message.success("\u5220\u9664\u6210\u529F"),this.getTableList()})})},handleChange(l,e){if(l.raw.type.indexOf("image/")==-1)return this.$message.warning("\u6587\u4EF6\u683C\u5F0F\u9519\u8BEF\uFF0C\u8BF7\u4E0A\u4F20\u56FE\u7247\u7C7B\u578B\uFF01"),!1;if(l.raw.type=="image/gif"){let n=new FormData;n.append("file",l.raw,l.name),this.fileForm=n}else{let n=this,r=new FileReader;r.readAsDataURL(l.raw),r.onload=function(t){let a=new Image,h=t.target.result;a.src=h,a.onload=function(){let u=n.toufangForm.pictureSize?n.toufangForm.pictureSize.split(" x ")[0]:1e3,C=n.toufangForm.pictureSize?n.toufangForm.pictureSize.split(" x ")[1]:100,F=document.createElement("canvas"),b=F.getContext("2d");F.width=u,F.height=C,b.clearRect(0,0,u,C),b.drawImage(a,0,0,u,C);let S=F.toDataURL("image").split(","),x=S[0].match(/:(.*?);/)[1],y=atob(S[1]),g=[];for(let V=0;V<y.length;V++)g.push(y.charCodeAt(V));let z=new Blob([new Uint8Array(g)],{type:x}),L=new File([z],l.name);n.fileForm=null;let N=new FormData;N.append("file",L,l.name),n.fileForm=N}}}e.length>1&&e.splice(0,1)},handleExceed(l){this.$refs.upload.clearFiles();let e=l[0];this.$refs.upload.handleStart(e)},submitFormData(){this.$refs.toufangForm.validate(l=>{if(l){if(this.dialogTitle==="\u65B0\u589E\u8BA1\u5212")if(this.fileForm){const e=this.$loading({lock:!0,text:"\u56FE\u7247\u4E0A\u4F20\u4E2D...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});k.addFile(this.fileForm).then(n=>{this.toufangForm.picturePath=n[0],this.fileForm=null}).then(()=>{T.addColumnPutPlan({xmtColumnManageId:this.toufangForm.xmtColumnManageId,programmeName:this.toufangForm.programmeName,type:this.toufangForm.type,platform:this.toufangForm.platform,picturePath:this.toufangForm.picturePath,putStartTime:this.toufangForm.putStartTime?this.toufangForm.putStartTime.getTime():"",putEndTime:this.toufangForm.putEndTime?this.toufangForm.putEndTime.getTime():"",pictureSize:this.toufangForm.pictureSize,remark:this.toufangForm.remark}).then(()=>{e.close(),this.dialogVisible=!1,this.$message.success("\u65B0\u589E\u8BA1\u5212\u6210\u529F!"),this.$refs.toufangForm.resetFields(),this.lanmu2="",this.getTableList()})})}else this.$message.warning("\u8BF7\u4E0A\u4F20\u56FE\u7247");else if(this.dialogTitle==="\u7F16\u8F91\u8BA1\u5212")if(this.fileForm){const e=this.$loading({lock:!0,text:"\u56FE\u7247\u4E0A\u4F20\u4E2D...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});k.addFile(this.fileForm).then(n=>{this.toufangForm.picturePath=n[0],this.fileForm=null}).then(()=>{T.editColumnPutPlan({id:this.toufangForm.id,xmtColumnManageId:this.toufangForm.xmtColumnManageId,programmeName:this.toufangForm.programmeName,type:this.toufangForm.type,platform:this.toufangForm.platform,picturePath:this.toufangForm.picturePath,putStartTime:this.toufangForm.putStartTime?this.toufangForm.putStartTime.getTime():"",putEndTime:this.toufangForm.putEndTime?this.toufangForm.putEndTime.getTime():"",pictureSize:this.toufangForm.pictureSize,remark:this.toufangForm.remark}).then(()=>{e.close(),this.dialogVisible=!1,this.$message.success("\u7F16\u8F91\u8BA1\u5212\u6210\u529F!"),this.$refs.toufangForm.resetFields(),this.lanmu2="",this.getTableList()})})}else T.editColumnPutPlan({id:this.toufangForm.id,xmtColumnManageId:this.toufangForm.xmtColumnManageId,programmeName:this.toufangForm.programmeName,type:this.toufangForm.type,platform:this.toufangForm.platform,picturePath:this.toufangForm.picturePath,putStartTime:this.toufangForm.putStartTime?this.toufangForm.putStartTime.getTime():"",putEndTime:this.toufangForm.putEndTime?this.toufangForm.putEndTime.getTime():"",pictureSize:this.toufangForm.pictureSize,remark:this.toufangForm.remark}).then(()=>{this.$message.success("\u7F16\u8F91\u8BA1\u5212\u6210\u529F!"),this.dialogVisible=!1,this.$refs.toufangForm.resetFields(),this.lanmu2="",this.getTableList()})}})},closeDialog(){this.dialogVisible=!1,this.$refs.toufangForm.resetFields(),this.lanmu2="",this.fileForm=null,this.fileList=[]},handleSizeChange(l){this.pageSize=l,this.currentPage=1,this.getTableList()},handleCurrentChange(l){this.currentPage=l,this.getTableList()},sortTable({prop:l,order:e}){e=="ascending"?(this.ascs=l,this.descs=""):e=="descending"?(this.ascs="",this.descs=l):(this.ascs="",this.descs=""),this.getTableList()},formatDate(l){let e=new Date(l),n=e.getFullYear(),r=e.getMonth()+1,t=e.getDate();r>=1&&r<=9&&(r="0"+r),t>=0&&t<=9&&(t="0"+t);let a=e.getHours(),h=e.getMinutes(),u=e.getSeconds();return a>=1&&a<=9&&(a="0"+a),h>=0&&h<=9&&(h="0"+h),u>=0&&u<=9&&(u="0"+u),n+"-"+r+"-"+t+" "+a+":"+h+":"+u}},created(){this.initList(),this.getTableList()}},A={class:"page order"},j={class:"content"},O={class:"tab-content"},W={class:"toolbox"},Y={class:"left"},G={class:"right"},J={class:"table"},K={key:0,class:"image-wrapper"},Q=c("span",null,"\u6682\u65E0\u56FE\u7247",-1),X={key:1},Z={key:2},$={key:3},ee={key:4},te={key:5},le=c("div",{style:{"margin-top":"5%"}},"\u6682\u65E0\u6570\u636E",-1),ae={class:"pagination"},ie={class:"dialog-footer"};function oe(l,e,n,r,t,a){const h=d("common-header"),u=d("el-input"),C=d("el-cascader"),F=d("el-date-picker"),b=d("el-button"),v=d("el-image"),S=d("el-table-column"),x=d("el-table"),y=d("el-pagination"),g=d("el-form-item"),z=d("el-upload"),L=d("el-form"),N=d("el-dialog"),V=I("loading");return f(),_("div",A,[o(h,{title:"\u6295\u653E\u8BA1\u5212"}),c("div",j,[c("div",O,[c("div",W,[c("div",Y,[o(u,{modelValue:t.programmeName,"onUpdate:modelValue":e[0]||(e[0]=i=>t.programmeName=i),style:{width:"250px","margin-right":"15px"},"prefix-icon":"el-icon-search",placeholder:"\u8BF7\u8F93\u5165\u8282\u76EE\u540D\u79F0",clearable:"",onBlur:a.search,onClear:a.search},null,8,["modelValue","onBlur","onClear"]),o(C,{modelValue:t.lanmu,"onUpdate:modelValue":e[1]||(e[1]=i=>t.lanmu=i),style:{width:"250px","margin-right":"15px"},props:{checkStrictly:!0},options:t.lanmuList,onChange:a.changeLanmu,placeholder:"\u4E00\u7EA7/\u4E8C\u7EA7/\u4E09\u7EA7",clearable:"",filterable:""},null,8,["modelValue","options","onChange"]),o(F,{modelValue:t.datetime,"onUpdate:modelValue":e[2]||(e[2]=i=>t.datetime=i),type:"daterange","start-placeholder":"\u6295\u653E\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u6295\u653E\u7ED3\u675F\u65F6\u95F4",style:{width:"350px"},onChange:a.changeTime},null,8,["modelValue","onChange"])]),c("div",G,[o(b,{type:"primary",onClick:a.addPutPlan},{default:s(()=>[w(" \u65B0\u589E\u8BA1\u5212 ")]),_:1},8,["onClick"])])]),c("div",J,[M((f(),D(x,{ref:"toufang",height:"100%",stripe:"",border:"",data:t.tableData,"header-cell-style":{background:"#eaf2fe",color:"#383838",fontSize:"16px",height:"34px"},"row-style":{height:"24px",fontSize:"14px"},onSortChange:a.sortTable,"scrollbar-always-on":""},{empty:s(()=>[le]),default:s(()=>[(f(!0),_(B,null,R(t.tableHeader,(i,m)=>(f(),D(S,{label:i.label,prop:m,align:"center","min-width":i.width?i.width+"":"100",sortable:"custom"},{default:s(p=>[m==="picturePath"?(f(),_("div",K,[o(v,{class:"image",lazy:"",src:t.baseUrl+p.row[m],"preview-src-list":t.srcList},{error:s(()=>[Q]),_:2},1032,["src","preview-src-list"])])):m==="putStartTime"?(f(),_("span",X,P(p.row[m]?a.formatDate(p.row[m]).split(" ")[0]:"-"),1)):m==="putEndTime"?(f(),_("span",Z,P(p.row[m]?a.formatDate(p.row[m]).split(" ")[0]:"-"),1)):m==="createTime"?(f(),_("span",$,P(p.row[m]?a.formatDate(p.row[m]).split(" ")[0]:"-"),1)):m==="updateTime"?(f(),_("span",ee,P(p.row[m]?a.formatDate(p.row[m]).split(" ")[0]:"-"),1)):(f(),_("span",te,P(p.row[m]?p.row[m]:"-"),1))]),_:2},1032,["label","prop","min-width"]))),256)),o(S,{fixed:"right",label:"\u64CD\u4F5C",align:"center","min-width":"120"},{default:s(i=>[o(b,{size:"small",type:"text",onClick:m=>a.delPutPlan(i.$index,i.row)},{default:s(()=>[w("\u5220\u9664")]),_:2},1032,["onClick"]),o(b,{size:"small",type:"text",onClick:m=>a.editPutPlan(i.$index,i.row)},{default:s(()=>[w("\u7F16\u8F91")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSortChange"])),[[V,t.loading]])]),c("div",ae,[o(y,{"current-page":t.currentPage,"page-size":t.pageSize,"page-sizes":[20,30,50,100],total:t.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:a.handleSizeChange,onCurrentChange:a.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),o(N,{"close-on-click-modal":!1,"close-on-press-escape":!1,modelValue:t.dialogVisible,"onUpdate:modelValue":e[12]||(e[12]=i=>t.dialogVisible=i),title:t.dialogTitle,width:"500px",onClosed:a.closeDialog},{footer:s(()=>[c("span",ie,[o(b,{onClick:a.closeDialog},{default:s(()=>[w("\u53D6\u6D88")]),_:1},8,["onClick"]),o(b,{type:"primary",onClick:a.submitFormData},{default:s(()=>[w("\u786E\u5B9A")]),_:1},8,["onClick"])])]),default:s(()=>[o(L,{ref:"toufangForm",model:t.toufangForm,"label-width":"120px","label-position":"left",rules:t.toufangRules},{default:s(()=>[o(g,{label:"\u6295\u653E\u4F4D\u7F6E\u7B5B\u9009",prop:"xmtColumnManageId"},{default:s(()=>[o(C,{modelValue:t.lanmu2,"onUpdate:modelValue":e[3]||(e[3]=i=>t.lanmu2=i),style:{width:"100%"},options:t.lanmuList,onChange:a.changeLanmu2,placeholder:"\u4E00\u7EA7/\u4E8C\u7EA7/\u4E09\u7EA7\u680F\u76EE"},null,8,["modelValue","options","onChange"])]),_:1}),o(g,{label:"\u6295\u653E\u8282\u76EE\u540D\u79F0",prop:"programmeName"},{default:s(()=>[o(u,{placeholder:"\u6295\u653E\u8282\u76EE\u540D\u79F0",modelValue:t.toufangForm.programmeName,"onUpdate:modelValue":e[4]||(e[4]=i=>t.toufangForm.programmeName=i)},null,8,["modelValue"])]),_:1}),o(g,{label:"\u7C7B\u578B",prop:"type"},{default:s(()=>[o(u,{placeholder:"\u7C7B\u578B",modelValue:t.toufangForm.type,"onUpdate:modelValue":e[5]||(e[5]=i=>t.toufangForm.type=i)},null,8,["modelValue"])]),_:1}),o(g,{label:"\u5E73\u53F0",prop:"platform"},{default:s(()=>[o(u,{placeholder:"\u5E73\u53F0",modelValue:t.toufangForm.platform,"onUpdate:modelValue":e[6]||(e[6]=i=>t.toufangForm.platform=i)},null,8,["modelValue"])]),_:1}),o(g,{class:"upload",label:"\u56FE\u7247",prop:"picturePath"},{default:s(()=>[o(z,{ref:"upload","file-list":t.fileList,"onUpdate:file-list":e[7]||(e[7]=i=>t.fileList=i),action:t.baseUrl+"/api/v1/bdca/files",accept:"image/*",limit:1,"on-exceed":a.handleExceed,"on-change":a.handleChange,"auto-upload":!1,"list-type":"picture"},{default:s(()=>[o(b,{type:"primary"},{default:s(()=>[w("\u4E0A\u4F20\u56FE\u7247")]),_:1})]),_:1},8,["file-list","action","on-exceed","on-change"])]),_:1}),o(g,{label:"\u6295\u653E\u5F00\u59CB\u65F6\u95F4",prop:"putStartTime"},{default:s(()=>[o(F,{modelValue:t.toufangForm.putStartTime,"onUpdate:modelValue":e[8]||(e[8]=i=>t.toufangForm.putStartTime=i),type:"date",placeholder:"\u6295\u653E\u5F00\u59CB\u65F6\u95F4",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(g,{label:"\u6295\u653E\u7ED3\u675F\u65F6\u95F4",prop:"putEndTime"},{default:s(()=>[o(F,{modelValue:t.toufangForm.putEndTime,"onUpdate:modelValue":e[9]||(e[9]=i=>t.toufangForm.putEndTime=i),placeholder:"\u6295\u653E\u7ED3\u675F\u65F6\u95F4",type:"date",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(g,{label:"\u56FE\u7247\u5C3A\u5BF8",prop:"pictureSize"},{default:s(()=>[o(u,{placeholder:"\u56FE\u7247\u5C3A\u5BF8",disabled:"",modelValue:t.toufangForm.pictureSize,"onUpdate:modelValue":e[10]||(e[10]=i=>t.toufangForm.pictureSize=i)},null,8,["modelValue"])]),_:1}),o(g,{label:"\u5907\u6CE8",prop:"remark"},{default:s(()=>[o(u,{placeholder:"\u5907\u6CE8",modelValue:t.toufangForm.remark,"onUpdate:modelValue":e[11]||(e[11]=i=>t.toufangForm.remark=i)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","onClosed"])])])])}var me=U(q,[["render",oe]]);export{me as default};
