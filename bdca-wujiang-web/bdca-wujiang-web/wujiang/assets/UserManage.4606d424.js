import{C as N}from"./CommonHeader.a228caf3.js";import{a as u}from"./api.22883e35.js";import{_ as E,C,a as A,r as d,k as B,o as c,c as F,d as o,b as g,e as q,w as l,m as W,i as b,f as h,t as V,l as k,F as x,h as v,p as Z,q as J}from"./index.22501be6.js";const j={components:{CommonHeader:N},data(){return{loading:!1,stationOptions:[],stationList:[],tableData:[],total:0,pageSize:20,currentPage:1,keyword:"",ascs:"",descs:"created",userInfo:{},station_grid:[],station:"",grid:"",dialogVisible:!1,dialogTitle:"",userForm:{id:"",touser:"",usernick:"",username:"",password:"",station_grid:"",station:"",grid:"",grade:"",role:""},userRules:{touser:[{required:!0,message:"\u8BF7\u8F93\u5165\u4F01\u4E1A\u5FAE\u4FE1ID",trigger:"blur"}],usernick:[{required:!0,message:"\u8BF7\u8F93\u5165\u59D3\u540D",trigger:"blur"}],username:[{required:!0,message:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",trigger:"blur"}],password:[{required:!0,validator:(e,i,a)=>{i===""?a(new Error("\u8BF7\u8F93\u5165\u5BC6\u7801")):/^(?![a-zA-Z]+$)(?![A-Z0-9]+$)(?![A-Z\W_]+$)(?![a-z0-9]+$)(?![a-z\W_]+$)(?![0-9\W_]+$)[a-zA-Z0-9\W_]{8,}$/.test(i)==!1?a(new Error("\u5BC6\u7801\u9700\u5305\u542B\u5927\u5C0F\u5199\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u7279\u6B8A\u5B57\u7B26\u81F3\u5C11\u4E09\u79CD\uFF0C\u81F3\u5C118\u4F4D")):a()},trigger:"blur"}],grade:[{required:!0,message:"\u8BF7\u9009\u62E9\u6743\u9650\u7B49\u7EA7",trigger:"change"}],station_grid:[{required:!0,message:"\u8BF7\u9009\u62E9\u5E7F\u7535\u7AD9",trigger:"change"}],role:[{required:!0,message:"\u8BF7\u9009\u62E9\u7CFB\u7EDF\u89D2\u8272",trigger:"change"}]},typeList:["\u7BA1\u7406\u5458","\u7AD9\u957F","\u7F51\u683C\u5458"],roleList:[],currentRoleId:""}},methods:{getTableList(){u.getUser({size:this.pageSize,current:this.currentPage,username:this.keyword,station:this.station,grid:this.grid,descs:this.descs,ascs:this.ascs}).then(s=>{this.tableData=s.records,this.total=s.total}).finally(()=>{this.loading=!1,this.$nextTick(()=>{this.$refs.table.doLayout()})})},search(){this.currentPage=1,this.getTableList()},change(s){this.station=s?s[0]:"",this.grid=s&&s.length>1?s[1]:"",this.getTableList()},addUser(){this.dialogTitle="\u65B0\u589E\u7528\u6237",this.dialogVisible=!0,this.userForm.id=""},editUser(s,e){this.dialogTitle="\u7F16\u8F91\u7528\u6237",Object.keys(this.userForm).forEach(t=>{this.userForm[t]=e[t]||this.userForm[t]}),this.changeGrade(),this.getUserRole(e.id);let i=[],a=e.grid?e.grid.split(","):[];a.length===0?i.push(e.station):a.forEach(t=>{i.push([e.station,t])}),this.userForm.station_grid=i,this.dialogVisible=!0},delUser(s,e){this.$confirm("\u60A8\u786E\u5B9A\u5220\u9664\u7528\u6237?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{u.delUser(e.id).then(()=>{this.$message.success("\u5220\u9664\u6210\u529F"),this.getTableList()})})},resetPwd(s,e){this.$confirm("\u60A8\u786E\u5B9A\u91CD\u7F6E\u5BC6\u7801?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{let i=this.randomPwd();u.resetUserPwd({userid:e.id,newpassword:i}).then(()=>{this.$message.success(`\u5BC6\u7801\u91CD\u7F6E\u6210\u529F\u4E3A"${i}"\uFF01`)})})},randomPwd(){const s=/^(?![a-zA-Z]+$)(?![A-Z0-9]+$)(?![A-Z\W_]+$)(?![a-z0-9]+$)(?![a-z\W_]+$)(?![0-9\W_]+$)[a-zA-Z0-9\W_]{8,}$/,e=new Array("A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9");let i,a=e.length;do{i="";for(let t=0;t<8;t++)i+=e[Math.floor(Math.random()*a)]}while(s.test(i)==!1);return this.userForm.password=i,i},closeDialog(){this.$refs.userForm.resetFields()},submitFormData(){this.$refs.userForm.validate(s=>{if(s){let e=this.userForm.station_grid&&this.userForm.station_grid.length?C(this.userForm.station_grid[0])?this.userForm.station_grid[0][0]:this.userForm.station_grid[0]:"",i=[];this.userForm.station_grid.forEach(a=>{i.push(C(a)?a[1]:"")}),this.dialogTitle==="\u65B0\u589E\u7528\u6237"?u.addUser({touser:this.userForm.touser,usernick:this.userForm.usernick,username:this.userForm.username,password:this.userForm.password,station:e,grid:i.join(","),grade:this.userForm.grade}).then(a=>{this.updateUserRole({userId:a.id,roleId:this.userForm.role=="normal"?"":this.userForm.role}).then(()=>{this.$message.success("\u65B0\u589E\u7528\u6237\u6210\u529F!"),this.loading=!1,this.dialogVisible=!1,this.getTableList()})}):(this.userForm.password&&(this.userForm.password=""),Promise.all([u.editUser({id:this.userForm.id,touser:this.userForm.touser,usernick:this.userForm.usernick,username:this.userForm.username,station:e,grid:i.join(","),grade:this.userForm.grade}),this.updateUserRole({userId:this.userForm.id,roleId:this.userForm.role=="normal"?"":this.userForm.role})]).then(a=>{this.$message.success("\u7F16\u8F91\u7528\u6237\u6210\u529F!"),this.loading=!1,this.dialogVisible=!1,this.getTableList()}))}})},handleSizeChange(s){this.pageSize=s,this.currentPage=1,this.getTableList()},handleCurrentChange(s){this.currentPage=s,this.getTableList()},sortTable({prop:s,order:e}){e=="ascending"?(this.ascs=s,this.descs=""):e=="descending"?(this.ascs="",this.descs=s):(this.ascs="",this.descs="created"),this.getTableList()},changeGrade(){this.userForm.station_grid=[],this.userForm.station="",this.userForm.grid="",this.userForm.grade=="\u7AD9\u957F"?this.stationOptions.forEach(s=>{s.children.forEach(e=>{e.disabled=!0})}):this.userForm.grade=="\u7F51\u683C\u5458"&&this.stationOptions.forEach(s=>{s.children.forEach(e=>{e.disabled=!1})})},computeStation(){let s=JSON.parse(JSON.stringify(window.config.stationOptions)),e=[];switch(this.userInfo.grade){case"\u7BA1\u7406\u5458":this.typeList=["\u7BA1\u7406\u5458","\u7AD9\u957F","\u7F51\u683C\u5458"],e=JSON.parse(JSON.stringify(window.config.stationOptions)),this.station_grid=[],this.station=this.userInfo.station,this.grid=this.userInfo.grid;break;case"\u7AD9\u957F":this.typeList=["\u7AD9\u957F","\u7F51\u683C\u5458"],s.forEach(a=>{a.value==this.userInfo.station&&e.push(a)}),this.station_grid=[this.userInfo.station],this.station=this.userInfo.station,this.grid=this.userInfo.grid;break;case"\u7F51\u683C\u5458":this.typeList=["\u7F51\u683C\u5458"];let i=this.userInfo.grid.split(",");e.push({label:this.userInfo.station,value:this.userInfo.station,children:[]}),i.forEach(a=>{e[0].children.push({label:a,value:a})}),this.station_grid=[this.userInfo.station,i[0]],this.station=this.userInfo.station,this.grid=i[0];break}this.stationOptions=e,this.stationList=JSON.parse(JSON.stringify(e))},getRole(){u.getRole().then(s=>{s.unshift({roleName:"\u666E\u901A\u7528\u6237",id:"normal"}),this.roleList=s})},getUserRole(s){u.getUserRole(s).then(e=>{this.userForm.role=e.length?e[0].roleId:"normal",this.currentRoleId=e.length?e[0].id:""})},updateUserRole(s){return s.roleId?u.updateUserRole(s):this.currentRoleId?u.delUserRole(this.currentRoleId):new Promise(function(e,i){e(1)})},changeRole(s){this.userForm.role=s}},created(){this.userInfo=JSON.parse(A.get("user")),this.computeStation(),this.getTableList()}},M=s=>(Z("data-v-65918e6e"),s=s(),J(),s),G={class:"page user-manage"},K={class:"content"},H={class:"toolbox"},Q={class:"left"},X={class:"right"},Y={class:"table"},$=M(()=>g("div",{style:{"margin-top":"5%"}},"\u6682\u65E0\u6570\u636E",-1)),ee={class:"pagination"},te={style:{width:"100%",display:"flex"}},se={class:"dialog-footer"};function re(s,e,i,a,t,n){const I=d("common-header"),_=d("el-input"),w=d("el-cascader"),p=d("el-button"),m=d("el-table-column"),U=d("el-table"),S=d("el-pagination"),f=d("el-form-item"),z=d("el-radio-button"),L=d("el-radio-group"),T=d("el-option"),R=d("el-select"),O=d("el-form"),P=d("el-dialog"),D=B("loading");return c(),F("div",G,[o(I,{title:"\u7528\u6237\u7BA1\u7406"}),g("div",K,[g("div",H,[g("div",Q,[o(_,{style:{width:"250px","margin-right":"16px"},"prefix-icon":"el-icon-search",modelValue:t.keyword,"onUpdate:modelValue":e[0]||(e[0]=r=>t.keyword=r),placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\u67E5\u8BE2",clearable:"",onBlur:n.search,onClear:n.search,onKeyup:q(n.search,["enter","native"])},null,8,["modelValue","onBlur","onClear","onKeyup"]),o(w,{modelValue:t.station_grid,"onUpdate:modelValue":e[1]||(e[1]=r=>t.station_grid=r),style:{width:"320px"},options:t.stationOptions,props:{checkStrictly:t.userInfo.grade!="\u7F51\u683C\u5458"},placeholder:"\u5E7F\u7535\u7AD9\u53CA\u7F51\u683C",clearable:t.userInfo.grade=="\u7BA1\u7406\u5458",filterable:"",onChange:n.change},null,8,["modelValue","options","props","clearable","onChange"])]),g("div",X,[o(p,{type:"primary",onClick:n.addUser},{default:l(()=>[h("\u65B0\u589E\u7528\u6237")]),_:1},8,["onClick"])])]),g("div",Y,[W((c(),b(U,{ref:"table",id:"table",height:"100%",stripe:"",border:"",data:t.tableData,"header-cell-style":{background:"#eaf2fe",color:"#383838",fontSize:"16px",height:"34px"},"cell-class-name":"cell-class","row-style":{height:"40px",fontSize:"14px"},onSortChange:n.sortTable},{empty:l(()=>[$]),default:l(()=>[o(m,{label:"\u8D26\u53F7",prop:"username",align:"center","min-width":"100",sortable:"custom"}),o(m,{label:"\u59D3\u540D",prop:"usernick",align:"center","min-width":"100",sortable:"custom"}),o(m,{label:"\u804C\u7EA7",prop:"grade",align:"center","min-width":"100",sortable:"custom"}),o(m,{label:"\u6240\u5C5E\u5E7F\u7535\u7AD9",prop:"station",align:"center","min-width":"180",sortable:"custom"}),o(m,{label:"\u6240\u5C5E\u7F51\u683C",prop:"grid",align:"center","min-width":"180",sortable:"custom"}),o(m,{label:"\u4F01\u4E1A\u5FAE\u4FE1ID",prop:"touser",align:"center","min-width":"120",sortable:"custom"}),o(m,{label:"\u7CFB\u7EDF\u89D2\u8272",align:"center","min-width":"120"},{default:l(r=>[h(V(r.row.roles&&r.row.roles.length?r.row.roles[0].roleName:"\u666E\u901A\u7528\u6237"),1)]),_:1}),o(m,{label:"\u64CD\u4F5C",align:"center","min-width":"160"},{default:l(r=>[o(p,{size:"small",type:"text",onClick:y=>n.delUser(r.$index,r.row)},{default:l(()=>[h("\u5220\u9664")]),_:2},1032,["onClick"]),o(p,{size:"small",type:"text",onClick:y=>n.editUser(r.$index,r.row)},{default:l(()=>[h("\u7F16\u8F91")]),_:2},1032,["onClick"]),o(p,{size:"small",type:"text",onClick:y=>n.resetPwd(r.$index,r.row)},{default:l(()=>[h("\u91CD\u7F6E\u5BC6\u7801")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSortChange"])),[[D,t.loading]])]),g("div",ee,[o(S,{"current-page":t.currentPage,"page-size":t.pageSize,"page-sizes":[20,30,50,100],total:t.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:n.handleSizeChange,onCurrentChange:n.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),o(P,{"close-on-click-modal":!1,"close-on-press-escape":!1,modelValue:t.dialogVisible,"onUpdate:modelValue":e[10]||(e[10]=r=>t.dialogVisible=r),title:t.dialogTitle,width:"480px",onClosed:n.closeDialog,onOpen:n.getRole},{footer:l(()=>[g("span",se,[o(p,{onClick:e[9]||(e[9]=r=>t.dialogVisible=!1)},{default:l(()=>[h("\u53D6\u6D88")]),_:1}),o(p,{type:"primary",onClick:n.submitFormData},{default:l(()=>[h("\u786E\u5B9A")]),_:1},8,["onClick"])])]),default:l(()=>[o(O,{ref:"userForm",model:t.userForm,"label-width":"120px","label-position":"left",rules:t.userRules},{default:l(()=>[o(f,{label:"\u8D26\u53F7",prop:"username"},{default:l(()=>[o(_,{placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",modelValue:t.userForm.username,"onUpdate:modelValue":e[2]||(e[2]=r=>t.userForm.username=r)},null,8,["modelValue"])]),_:1}),o(f,{label:"\u59D3\u540D",prop:"usernick"},{default:l(()=>[o(_,{placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D",modelValue:t.userForm.usernick,"onUpdate:modelValue":e[3]||(e[3]=r=>t.userForm.usernick=r)},null,8,["modelValue"])]),_:1}),t.dialogTitle=="\u65B0\u589E\u7528\u6237"?(c(),b(f,{key:0,inline:"",label:"\u5BC6\u7801",prop:"password"},{default:l(()=>[g("template",te,[o(_,{placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",modelValue:t.userForm.password,"onUpdate:modelValue":e[4]||(e[4]=r=>t.userForm.password=r),style:{flex:"1","margin-right":"16px"}},null,8,["modelValue"]),o(p,{type:"primary",plain:"",onClick:n.randomPwd,class:"pwd"},{default:l(()=>[h("\u968F\u673A\u5BC6\u7801")]),_:1},8,["onClick"])])]),_:1})):k("",!0),o(f,{label:"\u4F01\u4E1A\u5FAE\u4FE1ID",prop:"touser"},{default:l(()=>[o(_,{placeholder:"\u8BF7\u8F93\u5165\u4F01\u4E1A\u5FAE\u4FE1ID",modelValue:t.userForm.touser,"onUpdate:modelValue":e[5]||(e[5]=r=>t.userForm.touser=r)},null,8,["modelValue"])]),_:1}),o(f,{label:"\u7CFB\u7EDF\u89D2\u8272",prop:"role"},{default:l(()=>[o(L,{modelValue:t.userForm.role,"onUpdate:modelValue":e[6]||(e[6]=r=>t.userForm.role=r),onChange:n.changeRole},{default:l(()=>[(c(!0),F(x,null,v(t.roleList,r=>(c(),b(z,{key:r.id,label:r.id,value:r.id},{default:l(()=>[h(V(r.roleName),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),o(f,{label:"\u804C\u7EA7",prop:"grade"},{default:l(()=>[o(R,{placeholder:"\u8BF7\u9009\u62E9\u6743\u9650\u7B49\u7EA7",modelValue:t.userForm.grade,"onUpdate:modelValue":e[7]||(e[7]=r=>t.userForm.grade=r),clearable:"",filterable:"",onChange:n.changeGrade},{default:l(()=>[(c(!0),F(x,null,v(t.typeList,r=>(c(),b(T,{key:r,label:r,value:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),t.userForm.grade!=="\u7BA1\u7406\u5458"?(c(),b(f,{key:1,label:t.userForm.grade=="\u7F51\u683C\u5458"?"\u5E7F\u7535\u7AD9\u53CA\u7F51\u683C":"\u5E7F\u7535\u7AD9",prop:"station_grid"},{default:l(()=>[o(w,{placeholder:"\u8BF7\u9009\u62E9\u5E7F\u7535\u7AD9",modelValue:t.userForm.station_grid,"onUpdate:modelValue":e[8]||(e[8]=r=>t.userForm.station_grid=r),style:{width:"320px"},options:t.stationList,props:{multiple:t.userForm.grade=="\u7F51\u683C\u5458",checkStrictly:t.userForm.grade!=="\u7F51\u683C\u5458"},clearable:"",filterable:""},null,8,["modelValue","options","props"])]),_:1},8,["label"])):k("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","onClosed","onOpen"])])}var ae=E(j,[["render",re],["__scopeId","data-v-65918e6e"]]);export{ae as default};
