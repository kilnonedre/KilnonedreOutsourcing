import{C as N}from"./CommonHeader.a228caf3.js";import{k as x}from"./api.22883e35.js";import{i as D}from"./index.c073a47f.js";import{_ as M,u as O,r as m,o as h,c as p,d as n,b as _,w as s,F as g,h as y,f,i as c,t as w}from"./index.22501be6.js";const Y={components:{CommonHeader:N},data(){return{activeId:"",activeName:"",tabList:[],form:{mode:"day",time:[],station:[],level1:[],level2:[]},stationList:[{label:"\u603B\u8BA1",value:"\u603B\u8BA1"},...window.config.stationOptions],level1:[],level2:[],chart:null,data:[],showData:[],yAxis:[],header:[],showLabel:!0,option:{}}},methods:{getMenu(){x.getApi().then(e=>{this.tabList=e.records,this.activeId=this.tabList.length?this.tabList[0].id:"",this.activeName=this.tabList.length?this.tabList[0].name:""})},handleClick(e){this.activeId=e.props.name,this.activeName=e.props.label,this.reset()},getMonths(){x.getHistoryMonths({dailyApiId:this.activeId,month1:this.form.time&&this.form.time.length?this.form.time[0]:"",month2:this.form.time&&this.form.time.length?this.form.time[1]:""}).then(e=>{this.data=e,this.computeLevel(e)})},getDays(){x.getHistoryDays({dailyApiId:this.activeId,date1:this.form.time&&this.form.time.length?this.form.time[0]:"",date2:this.form.time&&this.form.time.length?this.form.time[1]:""}).then(e=>{this.data=e,this.computeLevel(e)})},computeLevel(e){for(let o in e)if(e[o].length){let d=[],i=[];for(let t in e[o][0])typeof e[o][0][t]=="object"&&i.push(...Object.keys(e[o][0][t])),t!=="\u4E2D\u5FC3\u53CA\u5E7F\u7535\u7AD9"&&d.push(t);this.level2=[...new Set(i)],this.level1=d;break}},reset(){var e;this.form={mode:this.form.mode,time:[],station:[],level1:[],level2:[]},this.level1=[],this.level2=[],(e=this.chart)==null||e.clear()},computeyAxis(){for(let e=0;e<this.form.level1.length;e++)for(let o=0;o<this.form.level2.length;o++)this.tableHeader.push()},confirm(){let e=JSON.parse(JSON.stringify(this.data));for(let i in e){let t=null,l=[];this.form.station.forEach(u=>{t=this.data[i].find(r=>r.\u4E2D\u5FC3\u53CA\u5E7F\u7535\u7AD9==u),l.push(t||[])}),e[i]=l}this.showData=e;let o=[],d=[];for(let i=0;i<this.form.station.length;i++)this.form.level1.forEach(t=>{this.form.level2.forEach(l=>{d.push(this.form.station[i]+"-"+t+"-"+l);let u=[];for(let r in e)u.push(e[r][i]&&e[r][i][t]?l.includes("\u7387")||l.includes("\u5EA6")?e[r][i][t][l]?e[r][i][t][l].slice(0,-1):"":e[r][i][t][l]:"");o.push(u)})});this.header=d,this.yAxis=o,this.drawChart()},drawChart(){var t;(t=this.chart)==null||t.clear();const e=this;this.chart=O(D(this.$refs.myChart));let o=this.header;this.data;let d=[];for(let l=0;l<this.yAxis.length;l++)d.push({name:o[l],type:"bar",smooth:!0,tooltip:{},itemStyle:{normal:{label:{show:this.showLabel,position:"top",textStyle:{fontSize:12,color:"#383838",fontWeight:"bold"}}}},data:this.yAxis[l]});let i={grid:{left:"5%",top:"35%"},tooltip:{trigger:"axis",axisPointer:{type:"cross",crossStyle:{color:"#999"}},formatter:function(l){let u=l[0].axisValue+": <br /> ";return l.forEach(r=>{u+=r.seriesName+"\uFF1A"+r.value+(r.value&&(r.seriesName.includes("\u7387")||r.seriesName.includes("\u5EA6"))?"%":"")+"<br />"}),u}},toolbox:{right:"20",feature:{magicType:{show:!0,title:{line:"\u5207\u6362\u4E3A\u6298\u7EBF\u56FE",bar:"\u5207\u6362\u4E3A\u67F1\u72B6\u56FE"},type:["line","bar"]},saveAsImage:{show:!0,title:"\u4FDD\u5B58\u4E3A\u56FE\u7247",name:"\u5404\u7AD9\u6570\u636E\u5BF9\u6BD4\u56FE"},myRestore:{show:!0,title:"\u91CD\u8F7D",icon:"image://./refresh.png",onclick:function(){e.chart.clear(),e.chart.setOption(i)}},myLabel:{show:!0,title:"\u663E\u793A/\u9690\u85CF\u6570\u636E",icon:"image://./show_data.png",onclick:function(){i.series.forEach(l=>{l.itemStyle.normal.label.show=!l.itemStyle.normal.label.show}),e.chart.clear(),e.chart.setOption(i)}}}},legend:{top:"40",textStyle:{fontSize:"1rem",fontWeight:"500"}},xAxis:[{type:"category",data:Object.keys(this.data),axisLabel:{interval:0,fontSize:"0.8rem",fontWeight:"bold",formatter:function(l){return e.form.mode=="day"?l:l.slice(0,-3)}},axisPointer:{type:"shadow"}}],yAxis:[{type:"value",alignTicks:!0,axisLine:{show:!0},axisLabel:{fontSize:"0.8rem",fontWeight:"bold"}}],dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}],series:d};this.chart.setOption(i),window.addEventListener("resize",()=>{this.chart.resize()})},dealWith(e){let o=e.split("");return o.length>10?o.slice(0,10).join("")+"...":e}},created(){this.getMenu()}},j={class:"page history"},E={class:"content"},U={class:"tab-content"},z={style:{"margin-left":"20px"}},H={class:"chart-wrap",ref:"myChart"};function T(e,o,d,i,t,l){const u=m("common-header"),r=m("el-tab-pane"),S=m("el-tabs"),V=m("el-radio-button"),A=m("el-radio-group"),C=m("el-date-picker"),b=m("el-form-item"),v=m("el-checkbox"),k=m("el-checkbox-group"),I=m("el-form"),L=m("el-button");return h(),p("div",j,[n(u,{title:"KPI\u5386\u53F2\u8D8B\u52BF"}),_("div",E,[n(S,{modelValue:t.activeId,"onUpdate:modelValue":o[0]||(o[0]=a=>t.activeId=a),class:"demo-tabs",onTabClick:l.handleClick},{default:s(()=>[(h(!0),p(g,null,y(t.tabList,a=>(h(),c(r,{label:a.name,name:a.id},null,8,["label","name"]))),256))]),_:1},8,["modelValue","onTabClick"]),_("div",U,[n(I,{ref:"form",model:t.form,"label-width":"120px","label-position":"left"},{default:s(()=>[n(b,{label:"\u7EDF\u8BA1\u5468\u671F"},{default:s(()=>[n(A,{modelValue:t.form.mode,"onUpdate:modelValue":o[1]||(o[1]=a=>t.form.mode=a),onChange:l.reset},{default:s(()=>[n(V,{label:"day",value:"day"},{default:s(()=>[f("\u6309\u65E5\u7EDF\u8BA1")]),_:1}),n(V,{label:"month",value:"month"},{default:s(()=>[f("\u6309\u6708\u7EDF\u8BA1")]),_:1})]),_:1},8,["modelValue","onChange"]),_("div",z,[t.form.mode==="day"?(h(),c(C,{key:0,modelValue:t.form.time,"onUpdate:modelValue":o[2]||(o[2]=a=>t.form.time=a),type:"daterange","range-separator":"-","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","value-format":"YYYY/MM/DD",onChange:l.getDays},null,8,["modelValue","onChange"])):(h(),c(C,{key:1,modelValue:t.form.time,"onUpdate:modelValue":o[3]||(o[3]=a=>t.form.time=a),type:"monthrange","range-separator":"-","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","value-format":"YYYY/MM",onChange:l.getMonths},null,8,["modelValue","onChange"]))])]),_:1}),n(b,{label:"\u4E2D\u5FC3\u53CA\u5E7F\u7535\u7AD9"},{default:s(()=>[n(k,{modelValue:t.form.station,"onUpdate:modelValue":o[4]||(o[4]=a=>t.form.station=a)},{default:s(()=>[(h(!0),p(g,null,y(t.stationList,a=>(h(),c(v,{key:a.label,label:a.label},{default:s(()=>[f(w(a.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(b,{label:"\u7EDF\u8BA1\u7EF4\u5EA6"},{default:s(()=>[n(k,{modelValue:t.form.level1,"onUpdate:modelValue":o[5]||(o[5]=a=>t.form.level1=a)},{default:s(()=>[(h(!0),p(g,null,y(t.level1,a=>(h(),c(v,{key:a,label:a},{default:s(()=>[f(w(a),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(b,{label:"\u7EDF\u8BA1\u6307\u6807"},{default:s(()=>[n(k,{modelValue:t.form.level2,"onUpdate:modelValue":o[6]||(o[6]=a=>t.form.level2=a)},{default:s(()=>[(h(!0),p(g,null,y(t.level2,a=>(h(),c(v,{key:a,label:a},{default:s(()=>[f(w(a),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]),_("div",null,[n(L,{onClick:l.reset},{default:s(()=>[f("\u91CD\u7F6E")]),_:1},8,["onClick"]),n(L,{type:"primary",onClick:l.confirm},{default:s(()=>[f("\u786E\u5B9A")]),_:1},8,["onClick"])]),_("div",H,null,512)])])])}var J=M(Y,[["render",T]]);export{J as default};
