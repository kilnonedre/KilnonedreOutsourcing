import{C as Y}from"./CommonHeader.a228caf3.js";import{E as H}from"./EditData.7093f99b.js";import{k as I}from"./api.22883e35.js";import{t as N}from"./table2excel.fee53b5f.js";import{_ as V,a as O,r as c,k as E,o as r,c as f,d as b,b as p,i as m,w as h,l as B,m as F,f as y,F as w,h as x,n as P,t as C,p as j,q as z}from"./index.22501be6.js";const A={components:{CommonHeader:Y,EditData:H},data(){return{date:new Date().getFullYear()+"",loading:!0,tableData:[],tableHeader:[],downLoading:!1,id:"",content:"",userInfo:JSON.parse(O.get("user"))}},created(){this.getTableList()},methods:{getTableList(){this.loading=!0,this.id="",this.tableData=[],this.tableHeader=[],I.getAnnual(this.date).then(e=>{e.records.length>0&&(this.id=e.records[0].id,this.content=e.records[0].content,this.tableData=JSON.parse(e.records[0].content),this.tableHeader=this.tableData.length?Object.keys(this.tableData[0]):[],console.log(this.tableHeader),this.tableData.splice(1,0))}).finally(()=>{this.loading=!1,this.$nextTick(()=>{this.$refs.annual.doLayout()})})},getDay(e,t){var o=new Date,_=o.getTime(),a=24*3600*1e3*e;o.setTime(parseInt(_+a));var i=o.getFullYear(),l=(o.getMonth()+1).toString();l.length<=1&&(l="0"+l);var n=o.getDate().toString();return n.length<=1&&(n="0"+n),i+t+l+t+n},changeTime(){this.getTableList()},getHeader(e){console.log(e)},getProp(e){let t;return typeof this.tableData[0][e]=="string"?t="":t=Object.keys(this.tableData[0][e]),t},onExport(){let e="",t=[],o=[];this.downLoading=!0,e=this.date,t=this.tableHeader,o=this.tableData;let _=[],a;for(let l=0;l<t.length;l++){if(typeof o[0][t[l]]=="string")a={title:t[l],key:t[l],type:"text"};else{let n=Object.keys(o[0][t[l]]),g=[];for(let d=0;d<n.length;d++)g.push({title:n[d],key:n[d],type:"text"});a={title:t[l],children:g}}_.push(a)}const i=`${e}-KPI\u5E74\u5EA6\u76EE\u6807`;N(_,o,i),this.downLoading=!1},editData(){this.$refs.editData.show=!0,this.$refs.editData.id=this.id,this.$refs.editData.kpi="annual",this.$refs.editData.date=this.date,this.$refs.editData.content=JSON.stringify(this.tableData,null,4)||this.content}},created(){this.getTableList()}},J=e=>(j("data-v-0c67caee"),e=e(),z(),e),U={class:"page annual"},K={class:"content"},M={class:"toolbox"},R={class:"left"},q={class:"right"},G={class:"table"},Q=J(()=>p("div",{style:{"margin-top":"5%"}},"\u6682\u65E0\u6570\u636E",-1));function W(e,t,o,_,a,i){const l=c("common-header"),n=c("el-date-picker"),g=c("el-button"),d=c("el-table-column"),T=c("el-table"),L=c("edit-data"),S=E("loading");return r(),f("div",U,[b(l,{title:"KPI\u5E74\u5EA6\u76EE\u6807"}),p("div",K,[p("div",M,[p("div",R,[b(n,{modelValue:a.date,"onUpdate:modelValue":t[0]||(t[0]=s=>a.date=s),type:"year",placeholder:"\u9009\u62E9\u5E74\u4EFD",format:"YYYY","value-format":"YYYY",clearable:!1,onChange:i.changeTime},null,8,["modelValue","onChange"])]),p("div",q,[a.userInfo.grade=="\u7BA1\u7406\u5458"?(r(),m(g,{key:0,type:"success",plain:"",onClick:i.editData},{default:h(()=>[y("\u7F16\u8F91\u6570\u636E")]),_:1},8,["onClick"])):B("",!0),b(g,{type:"primary",onClick:i.onExport,loading:a.downLoading},{default:h(()=>[y("\u5BFC\u51FA\u6570\u636E")]),_:1},8,["onClick","loading"])])]),p("div",G,[F((r(),m(T,{ref:"annual",id:"table",height:"100%",stripe:"",border:"",data:a.tableData,"header-cell-style":{background:"#eaf2fe",color:"#383838",fontSize:"16px",height:"34px"},"cell-class-name":"cell-class","row-style":{height:"24px",fontSize:"14px"}},{empty:h(()=>[Q]),default:h(()=>[(r(!0),f(w,null,x(a.tableHeader,(s,D)=>(r(),m(d,{key:s,label:s,align:"center","min-width":"180",fit:!0,fixed:D===0},{default:h(k=>[typeof a.tableData[0][s]=="string"&&s?(r(),f("span",{key:0,class:P(D===0?"blod":"")},C(k.row[s]?k.row[s]:"-"),3)):(r(!0),f(w,{key:1},x(i.getProp(s),u=>(r(),m(d,{key:u,label:u,align:"center","min-width":"90",fit:!0},{default:h(v=>[y(C(v.row[s][u]?v.row[s][u]:"-"),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["label","fixed"]))),128))]),_:1},8,["data"])),[[S,a.loading]])])]),b(L,{ref:"editData",onUpdate:i.getTableList},null,8,["onUpdate"])])}var ae=V(A,[["render",W],["__scopeId","data-v-0c67caee"]]);export{ae as default};
