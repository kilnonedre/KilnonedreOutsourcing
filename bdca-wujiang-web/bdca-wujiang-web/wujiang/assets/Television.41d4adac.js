import{C as E}from"./CommonHeader.a228caf3.js";import{A as M}from"./AddSubscription.c1b786fb.js";import{d as N}from"./api.22883e35.js";import{_ as P,C as y,a as U,r as h,k as J,o as d,c as u,d as c,b as r,w as g,T as F,m as D,i as k,F as v,h as T,f as w,D as q,p as G,q as K,t as f}from"./index.22501be6.js";import{t as Q}from"./table2excel.fee53b5f.js";import{_ as R}from"./icon_screen.7fe101fd.js";const _={dw1:{label:"\u4E2D\u5FC3\u53CA\u5E7F\u7535\u7AD9",width:"220"},dw2:{label:"\u4E8C\u7EA7\u673A\u6784",width:"200"},dateYmd:{label:"\u7EDF\u8BA1\u65E5\u671F",width:"180"},custCode:{label:"\u5BA2\u6237\u8BC1\u53F7",width:"200"},custName:{label:"\u5BA2\u6237\u59D3\u540D",width:"200"},custTag:{label:"\u5BA2\u6237\u6807\u8BC6",width:"120"},custType:{label:"\u5BA2\u6237\u7C7B\u578B",width:"120"},regionId:{label:"\u533A\u57DFID",width:"220"},regionName1:{label:"\u9547/\u8857\u9053",width:"180"},regionName2:{label:"\u6751/\u793E\u533A",width:"180"},regionName3:{label:"\u5C0F\u533A",width:"180"},loudong:{label:"\u697C\u680B",width:"180"},doorDesc:{label:"\u95E8\u724C",width:"180"},mobile1:{label:"\u79FB\u52A8\u7535\u8BDD1",width:"210"},mobile2:{label:"\u79FB\u52A8\u7535\u8BDD2",width:"210"},phone1:{label:"\u7535\u8BDD1",width:"210"},phone2:{label:"\u7535\u8BDD2",width:"210"},zt:{label:"\u72B6\u6001",width:"80"},restBalance:{label:"\u5F53\u524D\u4F59\u989D(\u5143)",width:"140"},payType:{label:"\u652F\u4ED8\u65B9\u5F0F",width:"120"},gridName:{label:"\u6240\u5C5E\u7F51\u683C",width:"200"},gridId:{label:"\u6240\u5C5E\u7F51\u683CID",width:"200"},doneDate:{label:"\u5BA2\u6237\u72B6\u6001\u53D8\u5316\u65F6\u95F4",width:"200"},createDate:{label:"\u5BA2\u6237\u521B\u5EFA\u65E5\u671F",width:"200"}},W={components:{CommonHeader:E,AddSubscription:M},data(){return{loading:!0,tableData:[],allHeader:_,tableHeader:[],showHeader:[],downLoading:!1,content:"",station_grid:[],station:"",gridName:"",stationOptions:[],payTypeOptions:[{label:"\u73B0\u91D1\u4EE3\u6263",value:"1"},{label:"\u652F\u4ED8\u5B9D",value:"2"},{label:"\u94F6\u884C\u4EE3\u6263",value:"3"}],date:[],currentPage:1,total:1,pageSize:100,ascs:"",descs:"",showScreen:!1,checkAll:!0,checkedHeaders:[],typeList:["\u6D41\u5931\u5BA2\u6237","\u56DE\u6D41\u5BA2\u6237","\u65B0\u5BA2\u6237"],type:"",userInfo:{}}},methods:{changeTime(e){this.getTableList()},getTableList(){this.loading=!0,this.tableData=[],N.getTelevision({date1:y(this.date)?this.date[0]:"",date2:y(this.date)?this.date[1]:"",dw1:this.station,gridName:this.gridName,custTag:this.type,size:this.pageSize,current:this.currentPage,descs:this.descs,ascs:this.ascs}).then(e=>{this.tableData=e.records,this.total=e.total}).finally(()=>{this.loading=!1,this.$nextTick(()=>{this.$refs.television.doLayout()})})},computeCheckedHeaders(e){let t=[];for(let o in e)t.push(o);return this.checkedHeaders=t,t},getDay(e,t){var o=new Date,p=o.getTime(),a=24*3600*1e3*e;o.setTime(parseInt(p+a));var s=o.getFullYear(),m=(o.getMonth()+1).toString();m.length<=1&&(m="0"+m);var b=o.getDate().toString();return b.length<=1&&(b="0"+b),s+t+m+t+b},handleSizeChange(e){this.pageSize=e,this.currentPage=1,this.getTableList()},handleCurrentChange(e){this.currentPage=e,this.getTableList()},sortTable({prop:e,order:t}){t=="ascending"?(this.ascs=e,this.descs=""):t=="descending"?(this.ascs="",this.descs=e):(this.ascs="",this.descs=""),this.getTableList()},onExport(){let e=[];this.downLoading=!0,N.getTelevision({date1:y(this.date)?this.date[0]:"",date2:y(this.date)?this.date[1]:"",dw1:this.station,gridName:this.gridName,custTag:this.type,size:-1,descs:this.descs,ascs:this.ascs}).then(t=>{t.records.forEach(s=>{s.restBalance=s.restBalance?s.restBalance/100:0,s.payType=s.payType?this.payTypeOptions[s.payType-1].label:""}),e=t.records;let o=[],p;for(let s in this.tableHeader)p={title:this.tableHeader[s].label,key:s,type:"text"},o.push(p);Q(o,e,"\u6570\u5B57\u7535\u89C6\u5BA2\u6237\u53D8\u5316\u660E\u7EC6")}).finally(()=>{this.downLoading=!1})},handleCheckAllChange(e){this.checkedHeaders=e?this.computeCheckedHeaders(_):[],this.showHeader=e?_:[]},handleCheckedHeaderChange(e){let t=e.length;this.checkAll=t===Object.keys(_).length;let o={};e.forEach(p=>{o[p]=this.allHeader[p]}),this.showHeader=o},clickScreen(){this.showScreen=!0},confirm(){this.tableHeader=this.showHeader,window.localStorage.setItem("television",JSON.stringify(this.tableHeader)),this.showScreen=!1,this.$nextTick(()=>{this.$refs.television.doLayout()})},cancel(){this.showHeader=this.tableHeader,this.showScreen=!1,this.checkAll=Object.keys(this.tableHeader).length===Object.keys(this.computeCheckedHeaders(this.tableHeader)).length},addSubscription(){this.$refs.subscription.show=!0},change(e){this.station=e?e[0]:"",this.gridName=e&&e.length>1?e[1]:"",this.getTableList()},changeType(){this.currentPage=1,this.getTableList()}},created(){this.date=[this.getDay(-1,"/"),this.getDay(-1,"/")];let e=window.localStorage.getItem("television");this.showHeader=e?JSON.parse(e):_,this.tableHeader=e?JSON.parse(e):_,this.computeCheckedHeaders(this.tableHeader),this.checkAll=Object.keys(this.showHeader).length===Object.keys(_).length,this.userInfo=JSON.parse(U.get("user"));let t=[],o=this.userInfo.grid?this.userInfo.grid.split(","):[];t.push({value:this.userInfo.station,label:this.userInfo.station,children:[]}),o.forEach(p=>{t[0].children.push({value:p,label:p})}),this.stationOptions=this.userInfo.grade=="\u7BA1\u7406\u5458"?window.config.stationOptions:t,this.station_grid=[this.userInfo.station],o.length&&this.station_grid.push(o[0]),this.station=this.userInfo.station,this.gridName=o[0],this.getTableList()}},S=e=>(G("data-v-1568e6ef"),e=e(),K(),e),X={class:"page television"},Z={class:"content"},$={class:"toolbox"},ee={class:"left"},te=S(()=>r("span",null,"\u6570\u636E\u65E5\u671F\uFF1A",-1)),ae={class:"date-pick"},se={class:"cascader"},le={class:"right"},ie={class:"table"},oe={class:"screen-wrap"},ne=S(()=>r("div",{style:{margin:"15px 0"}},null,-1)),re={key:0},he={key:1},de={key:2},ce={key:3},ge={key:4},pe=S(()=>r("div",{style:{"margin-top":"5%"}},"\u6682\u65E0\u6570\u636E",-1)),ue={class:"pagination"};function _e(e,t,o,p,a,s){const m=h("common-header"),b=h("el-date-picker"),I=h("el-cascader"),z=h("el-option"),L=h("el-select"),C=h("el-button"),V=h("el-tooltip"),H=h("el-checkbox"),O=h("el-checkbox-group"),Y=h("el-table-column"),x=h("el-table"),A=h("el-pagination"),B=h("add-subscription"),j=J("loading");return d(),u("div",X,[c(m,{title:"\u6570\u5B57\u7535\u89C6\u5BA2\u6237\u53D8\u5316\u660E\u7EC6"}),r("div",Z,[r("div",$,[r("div",ee,[te,r("div",ae,[c(b,{modelValue:a.date,"onUpdate:modelValue":t[0]||(t[0]=i=>a.date=i),type:"daterange",placeholder:"\u9009\u62E9\u65E5\u671F",format:"YYYY-MM-DD","value-format":"YYYY/MM/DD",onChange:s.changeTime,"start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4"},null,8,["modelValue","onChange"])]),r("div",se,[c(I,{modelValue:a.station_grid,"onUpdate:modelValue":t[1]||(t[1]=i=>a.station_grid=i),style:{width:"300px"},options:a.stationOptions,props:{checkStrictly:a.userInfo.grade!="\u7F51\u683C\u5458"},onChange:s.change,placeholder:"\u4E2D\u5FC3\u53CA\u5E7F\u7535\u7AD9",clearable:a.userInfo.grade=="\u7BA1\u7406\u5458",filterable:""},null,8,["modelValue","options","props","onChange","clearable"])]),r("div",null,[c(L,{modelValue:a.type,"onUpdate:modelValue":t[2]||(t[2]=i=>a.type=i),clearable:"",filterable:"",placeholder:"\u5BA2\u6237\u6807\u8BC6",onChange:s.changeType},{default:g(()=>[(d(!0),u(v,null,T(a.typeList,i=>(d(),k(z,{key:i,label:i,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])])]),r("div",le,[c(C,{type:"primary",onClick:s.onExport,loading:a.downLoading},{default:g(()=>[w("\u5BFC\u51FA\u6570\u636E")]),_:1},8,["onClick","loading"])])]),r("div",ie,[c(V,{effect:"dark",content:"\u7B5B\u9009\u8868\u683C\u5217",placement:"top"},{default:g(()=>[r("img",{onClick:t[3]||(t[3]=(...i)=>s.clickScreen&&s.clickScreen(...i)),class:"icon-screen",src:R,alt:""})]),_:1}),c(F,{name:"el-zoom-in-top"},{default:g(()=>[D(r("div",oe,[c(H,{modelValue:a.checkAll,"onUpdate:modelValue":t[4]||(t[4]=i=>a.checkAll=i),onChange:s.handleCheckAllChange},{default:g(()=>[w("\u5168\u9009")]),_:1},8,["modelValue","onChange"]),ne,c(O,{modelValue:a.checkedHeaders,"onUpdate:modelValue":t[5]||(t[5]=i=>a.checkedHeaders=i),onChange:s.handleCheckedHeaderChange},{default:g(()=>[(d(!0),u(v,null,T(a.allHeader,(i,l)=>(d(),k(H,{label:l,key:l},{default:g(()=>[w(f(i.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","onChange"]),c(C,{onClick:s.cancel,style:{"margin-top":"20px","margin-right":"20px"},size:"small"},{default:g(()=>[w("\u53D6\u6D88")]),_:1},8,["onClick"]),c(C,{onClick:s.confirm,style:{"margin-top":"20px","margin-right":"20px"},type:"primary",size:"small"},{default:g(()=>[w("\u786E\u5B9A")]),_:1},8,["onClick"])],512),[[q,a.showScreen]])]),_:1}),D((d(),k(x,{ref:"television",id:"table",height:"100%",stripe:"",border:"",data:a.tableData,"header-cell-style":{background:"#eaf2fe",color:"#383838",fontSize:"16px",height:"34px"},"cell-class-name":"cell-class","row-style":{height:"24px",fontSize:"14px"},onSortChange:s.sortTable},{empty:g(()=>[pe]),default:g(()=>[(d(!0),u(v,null,T(a.tableHeader,(i,l)=>(d(),k(Y,{"min-width":i.width?i.width+"":"100",fixed:l==="dw1"||l==="custName",fit:"",align:"center",sortable:"custom",prop:l,label:i.label},{default:g(n=>[l==="payType"?(d(),u("span",re,f(n.row[l]!==null&&n.row[l]!==void 0&&n.row[l]!==""&&!!a.payTypeOptions[n.row[l]-1].label?a.payTypeOptions[n.row[l]-1].label:"-"),1)):l==="dateYmd"?(d(),u("span",he,f(n.row[l]?n.row[l].split(" ")[0]:"-"),1)):l==="restBalance"?(d(),u("span",de,f(n.row[l]==null||n.row[l]==null?"-":n.row[l]/100),1)):l==="restBalance"?(d(),u("span",ce,f(n.row[l]?n.row[l]/100:"-"),1)):(d(),u("span",ge,f(n.row[l]?n.row[l]:"-"),1))]),_:2},1032,["min-width","fixed","prop","label"]))),256))]),_:1},8,["data","onSortChange"])),[[j,a.loading]])]),r("div",ue,[c(A,{onSizeChange:s.handleSizeChange,onCurrentChange:s.handleCurrentChange,"current-page":a.currentPage,"page-sizes":[100,200,300,400],"page-size":a.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:a.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])]),c(B,{ref:"subscription",station:a.station,gridName:a.gridName},null,8,["station","gridName"])])}var Ce=P(W,[["render",_e],["__scopeId","data-v-1568e6ef"]]);export{Ce as default};
