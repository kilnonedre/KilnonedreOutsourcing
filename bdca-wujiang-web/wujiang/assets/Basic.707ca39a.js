import{C as E}from"./CommonHeader.a228caf3.js";import{E as U}from"./EditData.7093f99b.js";import{k as v}from"./api.22883e35.js";import{t as z}from"./table2excel.fee53b5f.js";import{_ as J,a as F,r as c,k as j,o as r,c as D,d as u,b as l,w as d,i as p,l as y,m as w,F as I,h as L,f as _,n as Y,t as V,p as A,q}from"./index.22501be6.js";const K={components:{CommonHeader:E,EditData:U},data(){return{tabList:[],activeId:"",activeName:"",date1:"",date2:"",loading1:!0,tableData1:[],tableHeader1:[],loading2:!0,tableData2:[],tableHeader2:[],downLoading1:!1,downLoading2:!1,runId1:"",runId2:"",runLoading1:!1,runLoading2:!1,id1:"",id2:"",currentChart:"",topContent:"",bottomContent:"",radio:"\u5DEE\u503C",userInfo:JSON.parse(F.get("user"))}},methods:{getMenu(){v.getApi().then(i=>{this.tabList=i.records,this.activeId=this.tabList.length?this.tabList[0].id:"",this.activeName=this.tabList.length?this.tabList[0].name:"",this.getTableList(this.activeId,this.date1,"top"),this.getTableList(this.activeId,this.date2,"bottom")})},handleClick(i){this.activeId=i.props.name,this.activeName=i.props.label,this.getTableList(this.activeId,this.date1,"top"),this.getTableList(this.activeId,this.date2,"bottom")},getTableList(i,e,o){o=="top"?(this.loading1=!0,this.tableData1=[],this.tableHeader1=[],this.runId1="",this.topContent=""):o=="bottom"&&(this.loading2=!0,this.tableData2=[],this.tableHeader2=[],this.runId2="",this.bottomContent=""),v.getBasic(i,e).then(s=>{s.records.length>0&&(o==="top"?(this.topContent=s.records[0].content,this.runId1=s.records[0].id,this.tableData1=JSON.parse(s.records[0].content)||[],this.tableHeader1=this.tableData1.length?Object.keys(this.tableData1[0]):[],this.tableData1.splice(1,0)):o==="bottom"&&(this.bottomContent=s.records[0].content,this.runId2=s.records[0].id,this.tableData2=JSON.parse(s.records[0].content)||[],this.tableHeader2=this.tableData2.length?Object.keys(this.tableData2[0]):[],this.tableData2.splice(1,0)))}).then(()=>{o==="top"?this.loading1=!1:this.loading2=!1}).finally(()=>{this.$nextTick(()=>{this.$refs["table-top"].doLayout(),this.$refs["table-bottom"].doLayout()})})},getDay(i,e){var o=new Date,s=o.getTime(),t=24*3600*1e3*i;o.setTime(parseInt(s+t));var n=o.getFullYear(),h=(o.getMonth()+1).toString();h.length<=1&&(h="0"+h);var g=o.getDate().toString();return g.length<=1&&(g="0"+g),n+e+h+e+g},changeTime1(){this.getTableList(this.activeId,this.date1,"top")},changeTime2(){this.getTableList(this.activeId,this.date2,"bottom")},onExport(i){let e="",o=[],s=[];i==="top"?(this.downLoading1=!0,e=this.date1,o=this.tableHeader1,s=this.tableData1):i==="bottom"&&(this.downLoading2=!0,e=this.date2,o=this.tableHeader2,s=this.tableData2);let t=[];for(let h=0;h<o.length;h++)t.push({title:o[h],key:o[h],type:"text"});const n=`${e}-${this.activeName}`;z(t,s,n),i==="top"?this.downLoading1=!1:i==="bottom"&&(this.downLoading2=!1)},rerun(i){i==="top"?this.$confirm(`\u786E\u5B9A\u91CD\u65B0\u8BA1\u7B97${this.date1}-${this.activeName}?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{this.loading1=!0,v.rerun(this.runId1).then(e=>{this.$message.success("\u91CD\u65B0\u8BA1\u7B97\u6210\u529F\uFF01")}).finally(()=>{this.getTableList(this.activeId,this.date1,i),this.loading1=!1})}).finally(()=>{}):this.$confirm(`\u786E\u5B9A\u91CD\u65B0\u8BA1\u7B97${this.date2}-${this.activeName}?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{this.loading2=!0,v.rerun(this.runId2).then(e=>{this.$message.success("\u91CD\u65B0\u8BA1\u7B97\u6210\u529F\uFF01")}).finally(()=>{this.getTableList(this.activeId,this.date2,i),this.loading2=!1})}).finally(()=>{})},edit(i){let e="",o="",s="";i==="top"?(e=this.runId1,s=this.date1,o=JSON.stringify(this.tableData1,null,4)||this.topContent):(e=this.runId2,s=this.date2,o=JSON.stringify(this.tableData2,null,4)||this.bottomContent),this.$refs.editData.show=!0,this.$refs.editData.id=e,this.$refs.editData.kpi="daily",this.$refs.editData.date=s,this.$refs.editData.dailyApiId=this.activeId,this.$refs.editData.content=o},update(){this.getTableList(this.activeId,this.date1,"top"),this.getTableList(this.activeId,this.date2,"bottom")}},created(){this.getMenu(),this.date1=this.getDay(-1,""),this.date2=this.getDay(-2,"")}},S=i=>(A("data-v-3851e15c"),i=i(),q(),i),P={class:"page basic"},G={class:"content",ref:"tableCot"},Q={class:"tab-content"},R={class:"tab-top"},W={class:"toolbox"},X={class:"left"},Z={class:"right"},$={class:"table"},tt=S(()=>l("div",{style:{"margin-top":"5%"}},"\u6682\u65E0\u6570\u636E",-1)),et={class:"tab-bottom"},at={class:"toolbox"},it={class:"left"},ot={class:"radio-group"},st={class:"right"},lt={class:"table"},nt=S(()=>l("div",{style:{"margin-top":"5%"}},"\u6682\u65E0\u6570\u636E",-1));function dt(i,e,o,s,t,n){const h=c("common-header"),g=c("el-tab-pane"),M=c("el-tabs"),C=c("el-date-picker"),m=c("el-button"),k=c("el-table-column"),T=c("el-table"),N=c("el-radio-button"),B=c("el-radio-group"),H=c("edit-data"),x=j("loading");return r(),D("div",P,[u(h,{title:"KPI\u57FA\u7840\u6570\u636E"}),l("div",G,[u(M,{modelValue:t.activeId,"onUpdate:modelValue":e[0]||(e[0]=a=>t.activeId=a),class:"demo-tabs",onTabClick:n.handleClick},{default:d(()=>[(r(!0),D(I,null,L(t.tabList,a=>(r(),p(g,{label:a.name,name:a.id},null,8,["label","name"]))),256))]),_:1},8,["modelValue","onTabClick"]),l("div",Q,[l("div",R,[l("div",W,[l("div",X,[u(C,{modelValue:t.date1,"onUpdate:modelValue":e[1]||(e[1]=a=>t.date1=a),type:"date",placeholder:"\u9009\u62E9\u65E5\u671F",format:"YYYY-MM-DD","value-format":"YYYYMMDD","default-value":new Date,onChange:n.changeTime1},null,8,["modelValue","default-value","onChange"])]),l("div",Z,[t.userInfo.grade=="\u7BA1\u7406\u5458"?(r(),p(m,{key:0,plain:"",type:"success",onClick:e[2]||(e[2]=a=>n.edit("top"))},{default:d(()=>[_("\u7F16\u8F91\u6570\u636E")]),_:1})):y("",!0),t.userInfo.grade=="\u7BA1\u7406\u5458"?(r(),p(m,{key:1,plain:"",type:"primary",loading:t.runLoading1,onClick:e[3]||(e[3]=a=>n.rerun("top"))},{default:d(()=>[_("\u91CD\u65B0\u8BA1\u7B97")]),_:1},8,["loading"])):y("",!0),u(m,{type:"primary",onClick:e[4]||(e[4]=a=>n.onExport("top")),loading:t.downLoading1},{default:d(()=>[_("\u5BFC\u51FA\u6570\u636E")]),_:1},8,["loading"])])]),l("div",$,[w((r(),p(T,{ref:"table-top",stripe:"",border:"",data:t.tableData1,"header-cell-style":{background:"#eaf2fe",color:"#383838",fontSize:"16px",height:"34px"},"row-style":{height:"24px",fontSize:"14px"}},{empty:d(()=>[tt]),default:d(()=>[(r(!0),D(I,null,L(t.tableHeader1,(a,O)=>(r(),p(k,{label:a,align:"center","min-width":"60",fit:""},{default:d(b=>[l("span",{class:Y(Number(b.row[a])+""==NaN+""?"blod":"")},V(b.row[a]),3)]),_:2},1032,["label"]))),256))]),_:1},8,["data"])),[[x,t.loading1]])])]),l("div",et,[l("div",at,[l("div",it,[l("div",null,[u(C,{modelValue:t.date2,"onUpdate:modelValue":e[5]||(e[5]=a=>t.date2=a),type:"date",placeholder:"\u9009\u62E9\u65E5\u671F",format:"YYYY-MM-DD","value-format":"YYYYMMDD","default-value":new Date,onChange:n.changeTime2},null,8,["modelValue","default-value","onChange"])]),l("div",ot,[u(B,{modelValue:t.radio,"onUpdate:modelValue":e[6]||(e[6]=a=>t.radio=a)},{default:d(()=>[u(N,{label:"\u539F\u503C"}),u(N,{label:"\u5DEE\u503C"})]),_:1},8,["modelValue"])])]),l("div",st,[t.userInfo.grade=="\u7BA1\u7406\u5458"?(r(),p(m,{key:0,plain:"",type:"success",onClick:e[7]||(e[7]=a=>n.edit("bottom"))},{default:d(()=>[_("\u7F16\u8F91\u6570\u636E")]),_:1})):y("",!0),t.userInfo.grade=="\u7BA1\u7406\u5458"?(r(),p(m,{key:1,plain:"",type:"primary",loading:t.runLoading2,onClick:e[8]||(e[8]=a=>n.rerun("bottom"))},{default:d(()=>[_("\u91CD\u65B0\u8BA1\u7B97")]),_:1},8,["loading"])):y("",!0),u(m,{type:"primary",loading:t.downLoading2,onClick:e[9]||(e[9]=a=>n.onExport("bottom"))},{default:d(()=>[_("\u5BFC\u51FA\u6570\u636E")]),_:1},8,["loading"])])]),l("div",lt,[w((r(),p(T,{ref:"table-bottom",stripe:"",border:"",data:t.tableData2,"header-cell-style":{background:"#eaf2fe",color:"#383838",fontSize:"16px",height:"34px"},"row-style":{height:"24px",fontSize:"14px"}},{empty:d(()=>[nt]),default:d(()=>[(r(!0),D(I,null,L(t.tableHeader2,(a,O)=>(r(),p(k,{label:a,align:"center",prop:a,"min-width":"80",fit:""},{default:d(({row:b,$index:f})=>[l("span",{class:Y({blod:Number(b[a])+""==NaN+"",green:t.radio==="\u5DEE\u503C"&&(t.tableData1.length>0&&t.tableData1[f][a]?t.tableData1[f][a]:0)-b[a]<0,red:t.radio==="\u5DEE\u503C"&&(t.tableData1.length>0&&t.tableData1[f][a]?t.tableData1[f][a]:0)-b[a]>0})},V(Number(b[a])+""==NaN+""||t.radio==="\u539F\u503C"?b[a]:(t.tableData1.length>0&&t.tableData1[f][a]?t.tableData1[f][a]:0)-b[a]),3)]),_:2},1032,["label","prop"]))),256))]),_:1},8,["data"])),[[x,t.loading2]])])])])],512),u(H,{ref:"editData",onUpdate:n.update},null,8,["onUpdate"])])}var pt=J(K,[["render",dt],["__scopeId","data-v-3851e15c"]]);export{pt as default};
